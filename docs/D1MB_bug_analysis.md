---
title: D1-MB 4-Site Results: Bond Double-Listing Bug Analysis
section: Killed Approaches
status: active
---

# D1-MB 4-Site Results: Bond Double-Listing Bug Analysis

## Summary

The 4-site many-body computation reported `||Im(H)||/||Re(H)|| = 0.000000` for all U values â€” the Hamiltonian was purely real despite threading â„¤â‚ƒ flux. This was **not** a physics result. It was caused by a bug in the lattice builder that listed every bond in both directions with the same â„¤â‚ƒ phase. Combined with the Hamiltonian builder's forward+h.c. construction, this made all complex phases cancel exactly.

## The Mechanism

The Hamiltonian builder processes each neighbor entry `(i, j, d)` by adding:

- **Forward:** `câ€ _{iÎ±} c_{jÎ²}` with amplitude `Ï†_d Â· M_d[Î±,Î²]`
- **H.c.:** `câ€ _{jÎ²} c_{iÎ±}` with amplitude `Ï†_d* Â· M_d[Î±,Î²]`

This is correct when each undirected bond appears **once** in the neighbor list.

**3-site code** (correct): Hand-written list with 3 bonds, each listed once:
```
(0,1,0)  (0,2,1)  (1,2,2)
```
Result: `H[iÎ±,jÎ²] = Ï†_d Â· M_d[Î±,Î²]` â€” complex, hermitian, T-broken. âœ“

**4-site code** (buggy): Loop over all sites generates 12 directed bonds = 6 undirected bonds Ã— 2:
```
(0,1,0) AND (1,0,0)   â€” both direction 0, phase 1
(0,2,1) AND (2,0,1)   â€” both direction 1, phase Ï‰
(0,3,2) AND (3,0,2)   â€” both direction 2, phase Ï‰Â²
...
```

When both `(i,j,d)` and `(j,i,d)` are processed, the total amplitude becomes:
```
H[iÎ±,jÎ²] = Ï†_d Â· M_d[Î±,Î²] + Ï†_d* Â· M_d[Î±,Î²] = 2Â·Re(Ï†_d) Â· M_d[Î±,Î²]
```
This is **purely real** for any complex phase Ï†_d. The effective hopping amplitudes are `(2, -1, -1)` instead of `(1, Ï‰, Ï‰Â²)`.

## Why It's Specific to the 2Ã—2 Torus

On an `Lx Ã— Ly` torus, direction `d` maps site `(ix,iy)` to a neighbor `(jx,jy)`. The reverse bond `(jâ†’i)` is generated by the same direction `d` if and only if the lattice step is an **involution**:

| Direction | Step | Involutive when |
|-----------|------|-----------------|
| 0 | `(ix+1)%Lx` | `Lx = 2` |
| 1 | `(iy+1)%Ly` | `Ly = 2` |
| 2 | `(ix-1)%Lx, (iy-1)%Ly` | `Lx = 2` AND `Ly = 2` |

On the **2Ã—2 torus** (4 sites): all three directions are involutions â†’ 100% of bonds double-listed â†’ `Im/Re = 0.000000`.

On the **3Ã—2 torus** (6 sites): only direction 1 is involutive â†’ 3 out of 15 bonds (20%) double-listed â†’ `Im/Re = 0.655` (reduced from 0.905).

On any torus with `Lx â‰¥ 3` AND `Ly â‰¥ 3`: no involutions â†’ no double-listing â†’ original code would be correct.

## Numerical Verification

Single-particle hopping matrix (4 sites, 16Ã—16):

| Version | `||Im||/||Re||` | Hermitian | Real | Distinct eigenvalues |
|---------|-----------------|-----------|------|---------------------|
| Current (double-listed) | 0.000000 | âœ“ | âœ“ | 3 |
| Fixed (single-listed) | 1.000000 | âœ“ | âœ— | 4 |

The fixed code produces a complex hermitian Hamiltonian that is NOT real â€” confirming T-symmetry breaking is restored.

## Impact on the 4-Site Results

**What the 4-site run actually computed:**

The "â„¤â‚ƒ flux" run was a **real anisotropic hopping model** with effective amplitudes `(+2, -1, -1)` times the matching matrices. The "no-flux" run was a **real isotropic model** with amplitude `(+2, +2, +2)`. All reported results must be reinterpreted:

- **Level statistics (âŸ¨râŸ© â‰ˆ Poisson):** This is contaminated by both symmetry-sector mixing AND the absence of complex phases. Uninformative.
- **Ground state entanglement (S_gs â‰ˆ 0 with "flux"):** Measures the effect of real anisotropy `(2,-1,-1)` vs isotropy `(2,2,2)`, not â„¤â‚ƒ flux. The dimerized/localized ground state is an artifact of the anisotropic real model.
- **Im/Re = 0:** Code artifact, not physics.
- **All U>0 results:** Also affected â€” the interaction term is correct, but the kinetic term has wrong structure.

**What remains valid:**
- The 3-site many-body results (Im/Re = 1.0 at U=0, declining with U).
- The single-particle D1 results (computed in momentum space, unaffected by this bug).

## The Fix

Replace `build_triangular_lattice()` to track seen undirected bonds and skip duplicates:

```python
neighbors = []
seen_bonds = set()
for iy in range(Ly):
    for ix in range(Lx):
        i = site_index[(ix, iy)]
        for j, d in [(site_index[((ix+1)%Lx, iy)], 0),
                     (site_index[(ix, (iy+1)%Ly)], 1),
                     (site_index[((ix-1)%Lx, (iy-1)%Ly)], 2)]:
            bond = (min(i,j), max(i,j))
            if bond not in seen_bonds:
                seen_bonds.add(bond)
                neighbors.append((i, j, d))
```

This produces the correct number of bonds for all lattice sizes:

| Sites | Lattice | Bonds (current) | Bonds (fixed) | Im/Re (current) | Im/Re (fixed) |
|-------|---------|-----------------|---------------|------------------|----------------|
| 3 | triangle | 3 | 3 | 1.000 | 1.000 |
| 4 | 2Ã—2 torus | 12 | 6 | 0.000 | 1.000 |
| 6 | 3Ã—2 torus | 18 | 15 | 0.655 | 0.905 |

## Next Steps

1. **Apply the fix** to `computation_D1_manybody.py`
2. **Re-run 4-site** with corrected code: `python computation_D1_manybody.py --nsites 4 --U 0 1 2 3 4 5 6 7 8 --full --noflux`
3. Key questions for the corrected run:
   - Does Im/Re remain nonzero for all U? (Expected: yes, declining with U as seen at 3 sites)
   - Does âŸ¨râŸ© shift toward GUE now that T is genuinely broken? (The relevant ensemble IS GUE now)
   - Does the entanglement asymmetry (S_gs with flux vs without) persist or was it purely the anisotropy?
4. **6-site correction** is also needed (20% of bonds were affected), though less severe

## Implications for the Physics Program

The fundamental question â€” does â„¤â‚ƒ flux prevent equilibrium at the many-body level â€” **has not yet been answered at 4 sites**. The 3-site data (dim=924) is the only valid many-body result, and it showed:

- T-breaking survives second quantization (Im/Re = 1.0 at U=0, declining to 0.054 at U=8)
- Level statistics between Poisson and GOE (not GUE), but at a system size too small to be conclusive
- â„¤â‚ƒ flux enhances thermalization relative to no-flux

The corrected 4-site run is now the critical next computation. With genuine T-breaking restored, âŸ¨râŸ© should be compared to GUE (0.5996), not GOE (0.5307), and the "decision point" analysis from the D1-MB results document applies.
